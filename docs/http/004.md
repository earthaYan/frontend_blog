---
title: vite
titleTemplate: 构建工具
outline: "deep"
---

# vite

## 优势

痛点：

1. webpack 配置复杂，Loader & Plugin 学习成本高；vite 倾向于开箱即用
2. 构建速度慢：
   - 解析依赖树要遍历整个项目
   - Loader 串行执行
   - 没有合理分包、缓存和热更新优化
     > 当冷启动开发服务器时，基于打包器的方式启动必须优先抓取并构建你的整个应用，然后才能提供服务。当源文件被修改后，重新构建整个包是低效的，原因显而易见：更新速度会随着应用体积的增加而线性下降。
3. 输出包体积过大
   - 第三方没有按需加载
   - 图片、字体、css 全部塞进一个包
   - 没有做代码拆分
   - 没有启动 tree-shaking(死代码消除)

技术前提：浏览器开始原生支持 ES 模块

配置文件:vite.config.js

## 基本配置

```js
export default defineConfig(() => {
  return {
    base: "/",
    plugins: [
      vitePluginConditionalCompile({
        isDebug,
        expand: {
          isCoverage,
          isProduction,
          isXinChuang,
          isBCS,
          notBCS,
        },
      }),
      react({
        babel: {
          plugins: isCoverage ? ["istanbul"] : [],
        },
      }),
      reactSvgPlugin({}),
      eslint(),
      legacy({
        modernPolyfills: true,
        renderLegacyChunks: false,
      }),
    ],
    build: {
      commonjsOptions: {
        ignoreDynamicRequires: false,
      },
      target: "chrome65",
    },
    resolve: {
      //设置路径别名
      alias: [
        //处理 ~ 前缀的路径
        { find: /^~/, replacement: "" },
        {
          find: /^@antv\/g6/,
          replacement: path.resolve(
            __dirname,
            "./node_modules/@antv/g6/dist/g6.min.js"
          ),
        },
      ],
    },
    css: {
      preprocessorOptions: {
        less: {
          // 支持内联 JavaScript
          javascriptEnabled: true,
          //为每一段样式内容添加额外的代码
          additionalData: (content, loaderContext) => {
            var reg = /antd.+\.less/i;
            if (reg.test(loaderContext)) {
              // 如果是 antd 的 Less 文件
              //返回空字符串，表示不需要继续处理该文件内容
              return "";
            }
            return `@import "@/assets/styles/global.less"; @import "@/assets/styles/variables.less"; ${content}`;
          },
        },
      },
      modules: {
        localsConvention: "camelCaseOnly",
      },
    },
    esbuild: {
      //忽略告警
      logOverride: { "this-is-undefined-in-esm": "silent" },
      //指定了要将代码转换成适应的 JavaScript 版本或浏览器环境。
      target: "chrome65",
    },
    server: {
      port: 5600,
      host: "0.0.0.0",
      open: true,
      proxy: {
        "^(/v|/static/logo|/extended)": {
          target: "http://10.186.57.67:25799",
        },
      },
    },
  };
});
```

## 高级特性

> 性能优化=优化构建速度+优化产出代码

## 优化构建速度

## 优化产出代码
