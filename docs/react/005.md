---
title: React hooks
titleTemplate: react
outline: "deep"
---

# React hooks

## class 组件的问题

1. 大型 class 组件难以拆分和重构，难测试
2. 相同业务逻辑，分散到各个方法中，逻辑混乱
3. 复用逻辑变得复杂,比如 HOC、Render props

## state hook

1. 默认函数组件无 state
2. 函数组件为纯函数，执行完就会销毁，无法存储 state

> 所以需要 state hook，把 state/setState 功能 hook 到纯函数

语法：`const [count,setCount]=useState(0)`

## effect hook

### useEffect

1. 默认函数组件无生命周期
2. 函数组件执行完就会销毁，自己无法实现生命周期

> 解决方案：利用 useEffect 的第二个参数模拟 class 组件的生命周期

语法：`useEffect(()=>{},[])`

副作用：对函数之外造成影响，比如设置全局定时任务

默认：执行纯函数，输入参数并返回结果，无副作用，而组件需要副作用，所以需要 useEffect

清除副作用：在 useEffect 回调函数里返回一个函数,用来清除定时器、事件监听器等

执行时机：浏览器绘制完成后（异步执行）

### useEffect 返回函数 fn

- 依赖为`[]`:组件销毁时执行 fn,类似于 WillUnMount
- 无依赖参数或`[a,b]`:组件更新时执行 fn

> 总结：无论是更新还是卸载，下一次执行 useEffect 之前就会执行 fn

### useLayoutEffect

执行时机：DOM 变更后但浏览器重新绘制前（同步执行），会阻塞渲染会阻塞导致性能问题

主要用于处理 DOM 操作、调整样式、避免页面闪烁等问题

## 其他 hook

### useRef & useImperativeHandle

### useContext

### useMemo

### useReducer

### useCallback

## 自定义 hook

## 组件逻辑复用

## hooks 的注意事项

1. 命名`useXxxx`
2. 只能用于函数组件和自定义 Hook 中
3. 只能用于顶层代码，不能在循环、判断中使用 hooks
4. eslint 插件 eslint-plugin-react-hooks
