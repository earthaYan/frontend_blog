---
title: webpack
titleTemplate: build tools
outline: "deep"
---

# webpack

前端打包工具，类似的还有 vite。内容包括基本/高级配置、优化打包效率、优化产出代码以及构建流程概述和 babel

## 基本配置

### 拆分配置和 merge

有 3 个文件

- `webpack.common.js`:公共配置
- `webpack.dev.js`：开发环境
- `webpack.prod.js`：生产环境

在后两者中都需要引入`webpack.common.js`,该功能通过`smart`实现

```js
const webpackCommonConfig = require("./webpack.common.js");
const { smart } = require("webpack-merge");
module.exports = smart(webpackCommonConfig, {
  mode: "development",
});
```

通用配置包括：

```js
module.exports = {
  entry: path.join(srcPath, "index"),
  output: {
    //内容没变则hash不变
    filename: "bundle.[contentHash:8].js",
    path: distPath,
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        loader: ["babel-loader"],
        include: srcPath,
        exclude: /node_modules/,
      },
    ],
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: path.join(srcPath, "index.html"),
      filename: "index.html",
    }),
  ],
};
```

非通用配置举例：

- mode:development/production
- devServer

### 启动本地服务

需要安装 webpack-dev-server,对应的配置项是 devServer

### 设置代理

webpack 下跨域请求其他接口

前端端口 8080，后端服务端口 3000

```js
proxy:{
    //本地/api/xxx代理到http://localhost:3000/api/xxx
    '/api':"http://localhost:3000",
    //本地/api2/xxx代理到http://localhost:3000/xxx
    '/api2':{
        target:"http://localhost:3000",
        pathRewrite:{
            '/api2':''
        }
    }
}
```

### 处理 ES6

使用 babel-loader 处理,需要配置`.babelrc`

::: code-group

```js [webpack]
rules: [
  {
    test: /\.js$/,
    loader: ["babel-loader"],
    include: srcPath,
    exclude: /node_modules/,
  },
];
```

```js [babel配置文件]
{
    "presets":["@babel/preset-env"],
    "plugins":[]
}
```

:::

### 处理样式

postcss:处理浏览器兼容性,自动添加前缀

loader 数组中执行顺序为从后往前

```js
[
  {
    test: /\.css$/,
    loader: ["style-loader", "css-loader", "postcss-loader"],
  },
  {
    test: /\.less$/,
    loader: ["style-loader", "css-loader", "less-loader"],
  },
];
```

postcss 配置文件

```js
module.exports = {
  plugins: [require("autoprefixer")],
};
```

### 图片处理

1. 直接引入图片 url

::: code-group

```js [开发环境]
{
    test:/\.(png|jpg|jpeg|gif)$/,
    use:'file-loader'
}
```

```js [生产环境]
{
    test:/\.(png|jpg|jpeg|gif)$/,
    use:{
        loader:'url-loader',
        //图片小于5kb用base64格式
        //否则延用file-loader的形式，产出url格式
        options:{
            limit:5*1024,
            outPath:"/img1/",
            publicPath:"http://cdn.abc.com"
        }
    }
}
```

:::

### 模块化

天生支持 ES、CommonJS、AMD 模块

## 高级特性

### 多入口

一个项目中多个页面

```js
module.exports = {
  entry: {
    index: path.join(srcPath, "index.js"),
    others: path.join(srcPath, "others.js"),
  },
  output: {
    filename:[name].[contentHash:8].js,
    path:distPath
  },
  plugins:[
    new HtmlWebpackPlugin({
      template: path.join(srcPath, "index.html"),
      filename: "index.html",
      chunks:['index']//只引用index.js
    }),
    new HtmlWebpackPlugin({
      template: path.join(srcPath, "others.html"),
      filename: "others.html",
      chunks:['others'] //只引用others.js
    }),
    //默认清空output.path文件夹
    new CleanWebpackPlugin()
  ]
};
```

### 抽离 css 文件

### 抽离公共代码和第三方代码

### 异步加载 js

## 热更新配置

自动刷新：整个网页全部刷新，速度较慢，且状态会丢失

热更新：新代码生效，网页不刷新，状态不丢失

```js
module.exports = {
  watch: true,
  watchOptions: {
    ignored: /node_modules/,
    aggregateTimeout: 300,
    poll: 1000,
  },
};
```

## 性能优化

性能优化=优化构建速度+优化产出代码

### 优化构建速度

### 优化产出代码

## babel

### polyfill

### runtime
